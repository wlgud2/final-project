### 오류

1. git 에서 clone하고 sts에서 프로젝트 열었을 때 build.gradle 우클릭 시, gradle 탭이 없는 것을 확인

- 해결
  - Configure - Add Gradle Nature
  - [참조](https://bug41.tistory.com/130)

2. RDS 할 때 오하이오주로 설정해서 실행했기 때문에 시간이 다르게 뜸

- 해결
  - [참고(유튜브)](https://www.youtube.com/watch?v=EqkTT0yQwFE&t=2s)

3. UpdateForm에서 오류

   ```jsp
   codes [typeMismatch.msgVO.msgImage,typeMismatch.msgImage,typeMismatch.java.lang.String,typeMismatch];
   ```

- 원인

  - file타입을 String타입으로 변환하려고 해서 생긴 오류

- 해결 [참고](https://cloudstudying.kr/questions/7)

  - updateform.jsp의 input name 변경

  ```jsp
  <div class="col-sm-14" id="selectimg" style="display:none">          
      <input type="file" class="form-control" id="filenameMF" 
             name="filenameMF" accept=".jpg,.png,.gif" required="required">
  </div>
  to
  <div class="col-sm-14" id="selectimg" style="display:none">          
      <input type="file" class="form-control" id="filenameMF" 
             name="file" accept=".jpg,.png,.gif" required="required">
  </div>
  ```

4. UpdateForm에서의 오류2

   ```jsp
   java.lang.NullPointerException: Cannot invoke "org.springframework.web.multipart.MultipartFile.getSize()" because "mf" is null
   ```

- 

### 주요 진행 상황

1. 다른 사람의 DB 접속 *sqldeveloper이용*
	- [참조](https://javagirl.tistory.com/6)
	- application.properties에서
	- ```properties
	  # Oracle
	  spring.datasource.hikari.driver-class-name=oracle.jdbc.driver.OracleDriver
	  spring.datasource.hikari.jdbc-url: jdbc:oracle:thin:@**database-1.cxfxuru6havp.ap-northeast-2.rds.amazonaws.com**:**1521**:**ORCL**
	  spring.datasource.hikari.username=**admin**
	  spring.datasource.hikari.password=**Gksmf336!**
	  ```
	  
	  <img src="%EC%A7%84%ED%96%89%EC%83%81%ED%99%A9%20%EB%B0%8F%20%EC%98%A4%EB%A5%98.assets/db%EC%97%B0%EA%B2%B0.png" alt="db연결" style="zoom:80%;" />
	
	
	
2. git clone 후 project 기본 설정

   window-preference-general-workspace-text file encoding-utf-8

   ​							  -web browser-use external~-chrome

   ​     					     -server-runtime~-add-tomcat9.0-browes(톰캣 폴더설정)

   ​      					    -web-css files, html files, jsp files에서 utf-8로 변경

3. CRUD VIEW/(html) 페이지

   - views/contents폴더에 createForm.jsp, deleteForm.jsp, detail.jsp, updateFileForm.jsp, updateForm.jsp 생성

   - tiles에 tiles_contents 생성
   - TilesConfiguration코드 tiles/*.xml로 수정
   - com.project.contents 패키지 생성
     - ContentsController 생성, CRUD의 getmapping 설정

   - create: 내용, 사진, 태그, 날짜

     1) 내용 칸 넓게 하고 왼쪽에 라벨 없이 내용 입력 칸 안에 '내용'이라는 기본 글씨가 보이고, 글을 입력하면 없어지게 구현

    ```html
    방법1: <input type="text" name="search" value="검색" onfocus="this.value=''" />
    ```

     ```html
     방법2: <input type="text" name="formname" placeholder="기본적으로보일텍스트">
     ```

   ​		 2. [부트스트랩 GREED 시스템]

   ​	Bootstrap의 그리드 시스템에서 사용하고 있는 칼럼의 클래스 종류는 기본적으로 4가지가 있으며, 각각의 종류 뒤에는 12칼럼 중 몇개의 칼럼을 사용할지 명시하여 사용하면 된다.

   | .col-xs-* | 항상 가로로 배치                 |
   | --------- | -------------------------------- |
   | .col-sm-* | 768px 이하에서 세로로 표시 시작  |
   | .col-md-* | 992px 이하에서 세로로 표시 시작  |
   | .col-lg-* | 1200px 이하에서 세로로 표시 시작 |

   ​																																				[출처](https://unikys.tistory.com/371)

   ​	form-group이 없으면 margin 값이 없어서 다닥다닥 붙어서 나옴

     3. TEXTAREA 사용해서 여러줄 입력, 엔터로 줄바꿈 적용

        ```html
        <input type='text'>는 한 줄의 텍스트만 입력받는다
        ```

        textarea 칸에 기본 값 넣는 방법

        [참고](https://rh-cp.tistory.com/64)

        ```html
        input text에 값 넣기
        <input type="text" value="여기에 값을 넣어준다!"> 
        
        Textarea에 값 넣기
        <textarea rows="8" cols="85">"바깥부분에 값을 넣어준다!</textarea>
        ```

        

        받아오는 데이터의 줄바꿈 적용하는 법:[참고](https://dkfkslsksh.tistory.com/15)

        ```html
          <div class="form-group">
            <div class="col-sm-offset-2 col-xs-6">
              <textarea name="content" id="content" class="form-control" style="height:300px;resize:none;" placeholder="내용"></textarea>
            </div>
          </div>
        ```

        resize:none = 입력창 크기 조절할 수 없게 고정

   4. LABEL 태그

      <label>태그 사이에 위치한 text, checkbox, radio 등을 클릭하면 input 태그 영역으로 커서를 이동시킨다. for 속성을 input 태그의 id 속성과 일치시켜 사용.

   글 등록 버튼은 index에

   - orders페이지에 있는 3개의 jsp 파일 다 option 이용해서 value 보내고 선택할 수 있고
     value값을 숫자고 하고 > < 이 사이에 어느정도로 공개할 건지 쓰면 

4. notice view 페이지
   - 글 CRUD와 동일
   - interceptor 기능 추가하기

5. table(sql)

   <img src="%EC%A7%84%ED%96%89%EC%83%81%ED%99%A9%20%EB%B0%8F%20%EC%98%A4%EB%A5%98.assets/table.png" alt="table" style="zoom:80%;" /><img src="%EC%A7%84%ED%96%89%EC%83%81%ED%99%A9%20%EB%B0%8F%20%EC%98%A4%EB%A5%98.assets/table2.png" alt="table2" style="zoom:80%;" />

6. TAG-CONTENTS= N:M

   -> TAG-POSTTAG=1:N // POSTTAG-CONTENTS=M:1

   <img src="%EC%A7%84%ED%96%89%EC%83%81%ED%99%A9%20%EB%B0%8F%20%EC%98%A4%EB%A5%98.assets/DD.png" alt="DD" style="zoom:50%;" />

   insert: contents, tag -> posttag

   update, delete: posttag -> tag, contents

7. db연결

   - dto 생성

   - mybatis에 contents.xml 생성

     [해시태그 관련참고](https://velog.io/@juna-dev/%ED%95%B4%EC%8B%9C%ED%83%9C%EA%B7%B8-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0-9ak4xocihh)

     ```sql
     {call
             declare
             begin
                 insert	into zagook_contents(contentsno, id, filename, contents,
     			rdate, privacy)
     			values((select nvl(max(contentsno),0)+1
     			from zagook_contents),
     			#{id}, #{filename}, #{contents}, sysdate, #{privacy});
     			insert into zagook_tag(tag_id, tag)
     			values ((select nvl(max(tag_id),0)+1
     			from zagook_tag), #{tag});
     			insert into zagook_posttag(contentsno, tag_id)
     			values ((select max(contentsno)
     			from zagook_contents), (select max(tag_id)
     			from zagook_tag));
             end
         }
     ```
     
     아래의 방법이 안돼서 다중쿼리 넣는 다른 방법으로 시도.
     
     데이터는 들어가지만 뷰페이지 에러 발생-> 세 쿼리가 실행되는데 int로 받아서인가?
     
     
     
   - mybatis에서 여러 쿼리 실행시키는 법

     DB연결 부분에

     ```properties
     #?allowMultiQueries=true 붙여주기
     >>>application.properties에 추가
     spring.datasource.hikari.jdbc-url: jdbc:oracle:thin:@database-1.cxfxuru6havp.ap-northeast-2.rds.amazonaws.com:1521:ORCL?allowMultiQueries=true
     ```

   - createForm에서 id를 hidden으로 controller로 보내기

     ```jsp
        <input type="hidden" name="id" value="${id}">
     ```

     id 정보 가져가는 법: bbs의 updateform에서 

     ```jsp
     <input type =*"hidden"* name=*'oldfile'* value=*'*<%=dto.getFilename() %>*'*>
     ```

     bbs의 delete_ajax에서

     ```jsp
     <h1 class="col-sm-offset-2 col-sm-10">삭제</h1>
     		<input type="hidden" name='bbsno' id="bbsno" value="${param.bbsno}">
     		<input type="hidden" name='oldfile' id="oldfile" value="${param.oldfile}">
     		<input type="hidden" name='col' value='${param.col}'>
     		<input type="hidden" name='word' value='${param.word}'>
     		<input type="hidden" name='nowPage' value='${param.nowPage}'>
     		<div class="form-group">
     ```

     **textarea 값을 변수에 넣기 테스트**

     updateForm, createForm에서

     ```html
     <script>
     	contents = $("textarea#contents").val();
     </script>
     ```

   - contentsMapper, Service, ServiceImpl 생성

   - controller에 postmapping 추가

   - updateform 에서 사진 수정 버튼 누르면 바로 파일 선택이 되도록(수정 버튼은 hide) [참고](https://esckey.tistory.com/66)

     ```jsp
     <script type="text/JavaScript">
     	function updatefile(filename){
         	$('#updatebtn').hide(); 
     		$('#selectimg').show();
           }
     </script>
     ...
     <div class="col-sm-6">
         <img src="/images/${dto.filename}" style="width:500px">
         <br>
         <button type="button" class="btn btn-default" id="updatebtn"
                 onclick="javascript:updatefile('${dto.filename}')">수정</button>
         <div class="col-sm-6" id="selectimg" style="display:none">          
             <input type="file" class="form-control" id="filenameMF" 
                    name="filenameMF" accept=".jpg,.png,.gif" required="required">
        </div>
     </div>
     ```


   - 태그 내용 당 한 태그 아이디 대응

     : 중복값 있으면 입력하지 않기 위해(oracle)

     1. tag 테이블의 tag에 unique 제약조건 추가

     ```sql
     ALTER TABLE tablename ADD CONSTRAINT constraintname UNIQUE (columns);
     alter table zagook_tag add constraint uniquekey unique (tag);
     ```
     2. merge into 사용해서 중복값 있을 시 무시하고 없으면 insert하도록 [참고](https://mine-it-record.tistory.com/261)
     
        ```sql
        MERGE INTO [TABLE / VIEW] - update 또는 insert할 테이블 혹은 뷰
            USING [TABLE / VIEW / DUAL] -- 비교할 대상 테이블 혹은 뷰 (위 테이블과 동일할 경우 DUAL을 사용)
            ON [조건] -- UPDATE 와 INSERT 처리할 조건문 (조건이 일치하면 UPDATE / 불일치 시 INSERT)
            WHEN MATCHED THEN 
                  UPDATE SET
                  [COLUMN1] = [VALUE1],
                  [COLUMN2] = [VALUE2],
                  ...
                  (DELETE [TABLE] WHERE [COLUMN 1] = [VALUE 1] AND ...) -- UPDATE 뿐만 아니라 DELETE 구문도 사용 가능
            WHEN NOT MATCHED THEN
                 INSERT (COLUMN1, COLUMN2, ...)
                 VALUES (VALUE1, VALUE2, ...)
        
        -- 예제) 같은 테이블 비교 후 merge
        MERGE INTO employee
        USING DUAL
        ON (dev = #{dev} AND rog = #{rog})
            WHEN MATCHED THEN
            	UPDATE SET emble = #{emble} , rog = #{rog}
            WHEN NOT MATCHED THEN
            	INSERT (emp.emble, emp.rog, emp.tag)
            	VALUES (#{emble}, #{rog}, #{tag})
        
        -- 실제 작성 쿼리
        merge into zagook_tag
        	using dual
        	on (tag=#{tag})
        	when not matched then
        		insert (tag_id, tag)
        			values ((select nvl(max(tag_id),0)+1
        			from zagook_tag), #{tag})
        ```
        
        
     
   - update 쿼리문

     ```sql
     update zagook_contents
     		set contents=#{contents},
     		privacy=#{privacy}
     		where contentsno = #{contentsno}
     delete from zagook_posttag
         where contentsno=#{contentsno}
     ```

     1. 태그를 삭제했다면(tag=null)

     ```sql
     그냥 진행
     ```

     2. 태그를 수정(생성)했다면(tag != null)

     ```sql
     merge into zagook_tag
     using dual
     on (tag=#{tag})
          when not matched then
            insert (tag_id, tag)
            values ((select nvl(max(tag_id),0)+1
                          from zagook_tag), #{tag})
     insert into zagook_posttag(contentsno, tag_id)
     	values (#{contentsno}, (select tag_id from zagook_tag where tag=#{tag}))
     ```

        - updateform에서 수정 버튼 눌렀는데 아무 액션도 실행안되고 input file 버튼으로 자동 커서 이동

             />파일 넣지 않으면 수정 안됨

     - updateform에서 수정 버튼을 누르면 submit되는 현상 [참고](https://goodsgoods.tistory.com/274)

       /> 1. button 태그를 form 태그 안에서 밖으로 빼놓는다.

       ​    **2. button 태그를 input type="button"으로 바꾼다**

       ```jsp
       <input type="button" onclick="cancle()" value="취소">
       <input type="button" onclick="goSubmit()" value="확인">
       ```

     - index.jsp의 414라인에 contentsno 받아서 요청하는 법

       ```jsp
       <button type="button" class="btn" onclick="location.href='/contents/update/`+data.contentsno+`'">수정</button>
       <button type="button" class="btn" onclick="location.href='/contents/delete/`+data.contentsno+`">삭제</button>
       ```

     - 이미지 수정하면 바로 미리보기 뜨게 [참고](https://soomti.tistory.com/7)

       />>>updateForm.jsp

       ```jsp
       	 function PreviewImage() {
       		 // 파일리더 생성
       	        var preview = new FileReader();
       	        preview.onload = function (e) {
       	        // img id 값 
       	        document.getElementById("img").src = e.target.result;
       	    };
       	    // input id 값 
       	    preview.readAsDataURL(document.getElementById("filenameMF").files[0]);
       	 };
       </script>
       ...
       <div class="form-group">
           <div class="col-sm-6 col-sm-offset-2">
               <img id="img" src="/images/${oldfile}" style="width: 500px">
           </div>
           <div class="col-sm-6 col-sm-offset-2">
               <input type="button" id="updatebtn" onclick="javascript:updatefile('${oldfile}')" value="사진수정">
           </div>
           <div class="col-sm-6 col-sm-offset-2" id="selectimg" style="display: none">
               <input type="file" class="form-control" id="filenameMF"	name="filenameMF" accept=".jpg,.png,.gif" onchange="PreviewImage();" required="required">
           </div>
       ```

       

     	detail.jsp
     	<button type="button" class="btn"
     						onclick="location.href='/contents/update/${contentsno}/${dto.filename}'">
     						
     	controller
     		@GetMapping("/contents/update/{contentsno}/{oldfile}")
     		public String update(@PathVariable("contentsno") int contentsno, @PathVariable("oldfile") String oldfile,
     				Model model) {
     			ContentsDTO dto = service.detail(contentsno);
     			model.addAttribute("contentsno", contentsno);
     			model.addAttribute("oldfile", oldfile);
     			model.addAttribute("dto", dto);
     			return "/contents/update";
     		}

   - delete했을 때, 데이터 삭제되는데 오류메세지 뜸 -> return에서 redirect:/list로 되어있었는데, /list에 해당하는 주소가 없어서 --> **redirect:/**로 수정

   - index.jsp에서 삭제 버튼이 왜 작동안되는지? update랑 똑같이 했는데ㅠ^ㅠ

     

컨텐츠 넘버 좋아요 리플라이넘버

다 구현한 뒤 추가: 피드 좋아요/자국표시 누르면 메인 페이지 지도에도 자국 찍혀있는 기능?

